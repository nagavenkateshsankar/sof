<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .debug-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            margin: 5px;
            cursor: pointer;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        #debugOutput {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .quiz-iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Quiz UI Debug Test</h1>

    <div class="debug-section">
        <h2>Quiz Controls</h2>
        <button class="debug-button" onclick="loadQuiz()">Load Quiz</button>
        <button class="debug-button" onclick="nextQuestion()">Next Question</button>
        <button class="debug-button" onclick="debugElements()">Debug Elements</button>
        <button class="debug-button" onclick="clearDebug()">Clear Debug</button>
    </div>

    <div class="debug-section">
        <h2>Debug Output</h2>
        <div id="debugOutput"></div>
    </div>

    <div class="debug-section">
        <h2>Quiz Application</h2>
        <iframe id="quizFrame" class="quiz-iframe" src="src/quiz.html"></iframe>
    </div>

    <script>
        let debugOutput = document.getElementById('debugOutput');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.textContent += `[${timestamp}] ${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }

        function clearDebug() {
            debugOutput.textContent = '';
        }

        function loadQuiz() {
            log('Loading quiz...');
            const iframe = document.getElementById('quizFrame');
            iframe.src = iframe.src; // Reload iframe
            log('Quiz reloaded');
        }

        function nextQuestion() {
            try {
                const iframe = document.getElementById('quizFrame');
                const quizWindow = iframe.contentWindow;

                if (quizWindow && quizWindow.currentQuestion !== undefined) {
                    log(`Current question: ${quizWindow.currentQuestion + 1}`);

                    // Simulate timeout to move to next question
                    if (quizWindow.handleTimeout) {
                        log('Simulating timeout...');
                        quizWindow.handleTimeout();
                    } else {
                        log('ERROR: handleTimeout function not found');
                    }
                } else {
                    log('ERROR: Cannot access quiz window or currentQuestion');
                }
            } catch (error) {
                log(`ERROR: ${error.message}`);
            }
        }

        function debugElements() {
            try {
                const iframe = document.getElementById('quizFrame');
                const quizDoc = iframe.contentDocument || iframe.contentWindow.document;

                log('=== DEBUGGING ELEMENTS ===');

                // Check quiz content visibility
                const quizContent = quizDoc.getElementById('quizContent');
                if (quizContent) {
                    log(`quizContent display: ${getComputedStyle(quizContent).display}`);
                    log(`quizContent visibility: ${getComputedStyle(quizContent).visibility}`);
                } else {
                    log('ERROR: quizContent not found');
                }

                // Check question text
                const questionText = quizDoc.getElementById('questionText');
                if (questionText) {
                    log(`questionText content: "${questionText.textContent}"`);
                    log(`questionText display: ${getComputedStyle(questionText).display}`);
                    log(`questionText visibility: ${getComputedStyle(questionText).visibility}`);
                } else {
                    log('ERROR: questionText not found');
                }

                // Check question section
                const questionSection = quizDoc.querySelector('.question-section');
                if (questionSection) {
                    log(`question-section display: ${getComputedStyle(questionSection).display}`);
                    log(`question-section visibility: ${getComputedStyle(questionSection).visibility}`);
                    log(`question-section flex: ${getComputedStyle(questionSection).flex}`);
                } else {
                    log('ERROR: question-section not found');
                }

                // Check content wrapper
                const contentWrapper = quizDoc.getElementById('contentWrapper');
                if (contentWrapper) {
                    log(`contentWrapper classes: ${contentWrapper.className}`);
                    log(`contentWrapper display: ${getComputedStyle(contentWrapper).display}`);
                }

                // Check current question data
                const quizWindow = iframe.contentWindow;
                if (quizWindow && quizWindow.currentQuestion !== undefined) {
                    log(`Current question index: ${quizWindow.currentQuestion}`);
                    if (quizWindow.quizData && quizWindow.quizData[quizWindow.currentQuestion]) {
                        const currentQ = quizWindow.quizData[quizWindow.currentQuestion];
                        log(`Current question data: "${currentQ.question}"`);
                    }
                }

                // Check options container
                const optionsContainer = quizDoc.getElementById('optionsContainer');
                if (optionsContainer) {
                    log(`optionsContainer children count: ${optionsContainer.children.length}`);
                } else {
                    log('ERROR: optionsContainer not found');
                }

                log('=== DEBUG COMPLETE ===');

            } catch (error) {
                log(`ERROR during debugging: ${error.message}`);
            }
        }

        // Auto-debug when iframe loads
        document.getElementById('quizFrame').onload = function() {
            setTimeout(() => {
                log('Quiz loaded, running initial debug...');
                debugElements();
            }, 1000);
        };
    </script>
</body>
</html>